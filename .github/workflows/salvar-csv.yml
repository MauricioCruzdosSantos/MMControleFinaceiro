name: Salvar CSV Financeiro

on:
  repository_dispatch:
    types: [salvar_csv]

jobs:
  salvar_csv:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Criar ou atualizar o CSV
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          FILE="backup_financeiro.csv"
          CONTENT="$(echo "${{ github.event.client_payload.csv }}" | base64 -d)"
          
          # Cria ou atualiza o arquivo localmente
          echo "$CONTENT" > $FILE
          echo "Arquivo CSV atualizado."

          # Configura Git
          git config user.name "github-actions"
          git config user.email "actions@github.com"

          # Verificando se h√° altera√ß√µes antes de fazer commit
          git status
          git add $FILE
          git commit -m "üöÄ Atualiza√ß√£o autom√°tica do CSV" || echo "Nenhuma altera√ß√£o para commit."

          # Fazendo o push para o reposit√≥rio
          git push https://x-access-token:${GH_TOKEN}@github.com/${{ github.repository }}.git HEAD:main || echo "Erro ao fazer push."

          echo "Processo conclu√≠do!"

          name: Buscar CSV

on:
  repository_dispatch:
    types: [buscar_csv]  # Nome do evento que voc√™ est√° disparando

jobs:
  buscar_csv:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v2

      - name: Buscar arquivo CSV
        run: |
          echo "Buscando CSV..."
          # Adicione aqui o comando para buscar o arquivo CSV, por exemplo:
          curl -L -o backup_financeiro.csv https://raw.githubusercontent.com/MauricioCruzdosSantos/MMControleFinaceiro/main/backup_financeiro.csv

      - name: Processar CSV e retornar resposta
        run: |
          # Processar o arquivo CSV conforme necess√°rio. 
          # Por exemplo, voc√™ pode gerar um JSON e envi√°-lo de volta para o frontend.
          cat backup_financeiro.csv
          # Exemplo de c√≥digo para processar o CSV
          # converter CSV em JSON ou qualquer outra a√ß√£o
          # Este √© um passo b√°sico para exemplo, ajuste conforme necess√°rio

